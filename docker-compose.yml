version: "3.8"

services:
  # 1. Web ç®¡ç†æ§åˆ¶å°
  web:
    build: .
    container_name: bridge-web
    restart: always
    ports:
      - "9235:3000" # ğŸ‘ˆ å°†å®¿ä¸»æœºçš„ 3001 æ˜ å°„åˆ°å®¹å™¨çš„ 3000
    environment:
      - RUN_MODE=manual
      - REDIS_HOST=${REDIS_HOST}
      - REDIS_PORT=${REDIS_PORT}
      - REDIS_PASSWORD=${REDIS_PASSWORD}
      - METADATA_DB_URL=${METADATA_DB_URL}
    # åˆ æ‰äº† depends_on: redis

  # 2. Worker æ¶ˆè´¹è€…
  worker:
    build: .
    container_name: bridge-worker
    restart: always
    environment:
      - RUN_MODE=worker
      - REDIS_HOST=${REDIS_HOST}
      - REDIS_PORT=${REDIS_PORT}
      - REDIS_PASSWORD=${REDIS_PASSWORD}
      - METADATA_DB_URL=${METADATA_DB_URL}

  # 3. Scheduler è°ƒåº¦å™¨
  scheduler:
    build: .
    container_name: bridge-scheduler
    restart: always
    environment:
      - RUN_MODE=scheduler
      - REDIS_HOST=${REDIS_HOST}
      - REDIS_PORT=${REDIS_PORT}
      - REDIS_PASSWORD=${REDIS_PASSWORD}
      - METADATA_DB_URL=${METADATA_DB_URL}
