version: "3.8"

services:
  # 1. Web ç®¡ç†æ§åˆ¶å°
  web:
    build: .
    container_name: bridge-web
    network_mode: "host" # ğŸ‘ˆ æ ¸å¿ƒï¼šä¸å®¿ä¸»æœºå…±äº«ç½‘ç»œ
    restart: always
    environment:
      - PORT=9235 # ğŸ‘ˆ å¼ºåˆ¶è®© Next.js ç›‘å¬ 9235ï¼Œé¿å¼€ 3000 å†²çª
      - HOSTNAME=0.0.0.0 # ğŸ‘ˆ å¢åŠ ï¼šå…è®¸å¤–éƒ¨é€šè¿‡å…¬ç½‘ IP è®¿é—®
      - RUN_MODE=manual
      - REDIS_HOST=${REDIS_HOST}
      - REDIS_PORT=${REDIS_PORT}
      - REDIS_PASSWORD=${REDIS_PASSWORD}
      - METADATA_DB_URL=${METADATA_DB_URL}
      - APP_ENV=${APP_ENV}

  # 2. Worker æ¶ˆè´¹è€…
  worker:
    build: .
    container_name: bridge-worker
    network_mode: "host" # ğŸ‘ˆ æ ¸å¿ƒï¼šç¡®ä¿èƒ½é€šè¿‡ 127.0.0.1 è®¿é—® Redis/MySQL
    restart: always
    environment:
      - RUN_MODE=worker
      - REDIS_HOST=${REDIS_HOST}
      - REDIS_PORT=${REDIS_PORT}
      - REDIS_PASSWORD=${REDIS_PASSWORD}
      - METADATA_DB_URL=${METADATA_DB_URL}
      - APP_ENV=${APP_ENV}

  # 3. Scheduler è°ƒåº¦å™¨
  scheduler:
    build: .
    container_name: bridge-scheduler
    network_mode: "host"
    restart: always
    environment:
      - RUN_MODE=scheduler
      - REDIS_HOST=${REDIS_HOST}
      - REDIS_PORT=${REDIS_PORT}
      - REDIS_PASSWORD=${REDIS_PASSWORD}
      - METADATA_DB_URL=${METADATA_DB_URL}
      - APP_ENV=${APP_ENV}
